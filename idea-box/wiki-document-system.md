# 프로젝트 문서 시스템 설계

## 1. 기획 및 목적
### 목표
프로젝트 내부에서 사용할 문서 시스템 또는 위키를 구축하여 지속적으로 활용할 수 있는 시스템을 만드는 것이 목표입니다.
<br> 이 시스템은 프로젝트의 기획, 개발, 운영 관련 내용을 기록하고, 팀원들이 쉽게 접근하고 수정할 수 있도록 할 것입니다.
<br> 또한, 작성된 문서는 백업하거나 다른 시스템으로 이동하는 것도 가능해야 합니다.

### 목적
- **팀 내 공유**: 모든 팀원이 쉽게 문서를 작성하고 수정할 수 있게 하여, 정보의 전달과 협업을 원활하게 만듭니다.
- **문서 백업 및 이동**: 문서를 JSON이나 Markdown 형식으로 내보내거나, 다른 시스템으로 백업 및 통합할 수 있어야 합니다.
- **지식 관리**: 프로젝트 관련 지식을 체계적으로 관리하여 새로운 팀원의 온보딩을 용이하게 합니다.
- **의사결정 문서화**: 중요한 의사결정 과정과 결과를 문서화하여 추후 참조가 가능하게 합니다.

---

## 2. 기능 요구 사항
### 1. 마크다운 (Markdown) 지원
- 기본적인 텍스트 작성과 서식 지정, 목록, 링크 등을 마크다운 문법을 사용하여 지원합니다.
- 코드 블록 및 구문 강조 기능을 제공합니다.

### 2. HTML 태그 지원
- 사용자가 HTML 태그를 삽입할 수 있어야 하며, 이를 통해 더 복잡한 구조나 스타일링을 할 수 있습니다.
- 보안을 위해 허용된 HTML 태그와 속성만 필터링하여 사용할 수 있도록 합니다.

### 3. 나무위키 스타일 에디터 지원
- **나무위키 문법 지원**: 나무위키 고유의 마크업 문법을 지원하여 직관적인 문서화가 가능하게 합니다.
- **나무위키 표 기능**: 복잡한 데이터 구조를 표현할 수 있는 나무위키 스타일의 강력한 표 기능 구현
  - 셀 병합, 배경색 지정, 정렬 등 다양한 표 속성 지원
  - 표 내부에 다른 문법 요소 중첩 지원 (표 안에 리스트, 링크, 이미지 등)
- **문서 구조화 기능**: 목차 자동 생성, 문단별 편집, 접기/펼치기 기능 등 구현

### 4. CSS로 꾸미기 지원
- 문서에 CSS를 사용하여 스타일링을 추가할 수 있도록 하여 직관적이고 아름다운 문서를 만들 수 있습니다.
- 미리 정의된 테마를 선택할 수 있는 옵션도 제공합니다.

### 5. 문서 접근 및 공유
- **사용자 권한 관리**: 문서별로 읽기/쓰기/관리 권한을 설정할 수 있습니다.
- **모든 팀원 접근**: 권한이 있는 모든 팀원이 접근할 수 있어야 하며, 수정 및 기여도 가능해야 합니다.
- **백업 및 내보내기**: 문서를 JSON, Markdown, PDF, HTML 형식으로 내보낼 수 있어야 합니다.
- **공유 링크**: 특정 문서에 대한 공유 링크를 생성하여 외부 사용자와 공유할 수 있습니다.

### 6. 문서 버전 관리
- **버전 관리 시스템**: Git 기반으로 문서 수정 사항을 추적하고, 이전 버전으로 되돌릴 수 있습니다.
- **변경 이력 시각화**: 문서의 변경 이력을 타임라인 형태로 시각화하여 보여줍니다.
- **변경 사항 비교**: 서로 다른 버전 간의 차이점을 쉽게 비교할 수 있습니다.

### 7. 검색 및 분류 시스템
- **전체 텍스트 검색**: 모든 문서 내용에서 키워드를 검색할 수 있습니다.
- **태그 및 카테고리**: 문서에 태그를 부여하고 카테고리로 구분할 수 있습니다.
- **관련 문서 추천**: 내용 기반으로 관련 문서를 자동으로 추천해줍니다.

### 8. 실시간 협업 기능
- **동시 편집**: 여러 사용자가 동일한 문서를 동시에 편집할 수 있습니다.
- **변경 사항 실시간 동기화**: 다른 사용자의 변경 사항이 실시간으로 반영됩니다.
- **편집 충돌 해결**: 동시 편집 시 발생할 수 있는 충돌을 자동으로 해결합니다.

---

## 3. 기술 스택 및 아키텍처
### 1. 프론트엔드
- **프레임워크**: React.js
- **상태 관리**: Redux 또는 Context API
- **에디터 라이브러리**: 
  - 마크다운 에디터: ProseMirror 또는 TipTap (ProseMirror 기반)
  - 협업 기능: yjs (실시간 협업 데이터 구조)
- **UI 라이브러리**: Material-UI 또는 Tailwind CSS

### 2. 백엔드
- **서버**: Node.js + Express.js
- **데이터베이스**: 
  - 주 데이터베이스: MongoDB (문서 중심 데이터베이스)
  - 검색 엔진: Elasticsearch (전체 텍스트 검색)
- **실시간 통신**: Socket.io 또는 WebSocket
- **인증 및 권한**: JWT (JSON Web Tokens)

### 3. 데이터베이스 스키마
```
User {
  _id: ObjectId,
  username: String,
  email: String,
  password: String (hashed),
  role: String (admin, editor, viewer),
  createdAt: Date,
  updatedAt: Date
}

Document {
  _id: ObjectId,
  title: String,
  content: String (markdown/html),
  creator: ObjectId (ref: User),
  lastEditor: ObjectId (ref: User),
  category: ObjectId (ref: Category),
  tags: [String],
  permissions: {
    read: [ObjectId] (ref: User/Group),
    write: [ObjectId] (ref: User/Group),
    admin: [ObjectId] (ref: User/Group)
  },
  createdAt: Date,
  updatedAt: Date,
  version: Number,
  isPublished: Boolean
}

Version {
  _id: ObjectId,
  documentId: ObjectId (ref: Document),
  content: String,
  editor: ObjectId (ref: User),
  commitMessage: String,
  createdAt: Date,
  versionNumber: Number
}

Category {
  _id: ObjectId,
  name: String,
  description: String,
  parent: ObjectId (ref: Category),
  createdAt: Date,
  updatedAt: Date
}

Group {
  _id: ObjectId,
  name: String,
  description: String,
  members: [ObjectId] (ref: User),
  createdAt: Date,
  updatedAt: Date
}
```

### 4. 배포 및 인프라
- **컨테이너화**: Docker
- **오케스트레이션**: Docker Compose (소규모) 또는 Kubernetes (대규모)
- **CI/CD**: GitHub Actions 또는 GitLab CI
- **클라우드 서비스**: AWS, GCP, 또는 Azure
- **모니터링**: Prometheus + Grafana

---

## 4. 사용자 경험 (UX/UI)
### 1. 직관적인 에디터
- **WYSIWYG + 마크다운**: 시각적 에디터와 마크다운 모드 전환 가능
- **드래그 앤 드롭**: 이미지나 파일을 드래그하여 쉽게 첨부
- **단축키**: 자주 사용하는 기능에 단축키 제공
- **미리보기**: 작성 중인 문서의 최종 결과물 미리보기

### 2. 문서 탐색 및 관리
- **계층적 구조**: 폴더와 문서의 계층 구조로 관리
- **최근 문서**: 최근에 열람하거나 편집한 문서 목록 제공
- **즐겨찾기**: 자주 사용하는 문서를 즐겨찾기로 등록
- **문서 연결**: 문서 간의 상호 참조 및 링크 기능

### 3. 다양한 사용자 역할
- **관리자**: 전체 시스템 설정 및 사용자 관리
- **편집자**: 문서 생성 및 편집 권한
- **뷰어**: 문서 열람만 가능
- **커스텀 역할**: 필요에 따라 커스텀 역할 생성 가능

### 4. 알림 및 구독
- **문서 변경 알림**: 관심 있는 문서의 변경 사항 알림
- **멘션 기능**: @username 형태로 특정 사용자 멘션
- **구독**: 특정 카테고리나 태그에 대한 업데이트 구독

---

## 5. 구현 로드맵 및 우선순위
### 1단계: MVP (최소 기능 제품) 개발 (1-2개월)
- 기본 마크다운 에디터 구현
- 문서 생성, 조회, 수정, 삭제 기능
- 기본 사용자 인증 및 권한 관리
- 간단한 카테고리 및 태그 기능

### 2단계: 핵심 기능 확장 (2-3개월)
- Git 기반 버전 관리 시스템 통합
- 나무위키 스타일 에디터 기본 기능 구현
- 고급 검색 기능 (Elasticsearch 통합)
- 문서 내보내기/가져오기 기능

### 3단계: 협업 기능 강화 (2-3개월)
- 실시간 협업 편집 기능 (yjs 통합)
- 문서 변경 알림 및 구독 시스템
- 댓글 및 논의 기능
- 사용자 활동 로그 및 통계

### 4단계: 고급 기능 및 최적화 (3-4개월)
- CSS 스타일링 및 테마 지원
- API 개발 및 문서화
- 성능 최적화 및 캐싱 시스템
- 대규모 문서 관리를 위한 확장성 개선

---

## 6. 나무위키 스타일 에디터 구현 계획
### 주요 에디터 기능
1. **나무위키 문법 지원**:
   - 나무위키 고유의 마크업 문법을 완벽하게 지원하는 파서 개발
   - 제목, 목록, 인용, 각주, 링크 등 나무위키 특유의 문법 구현
   - 나무위키 스타일의 접기/펼치기 기능 구현

2. **핵심 표 기능 구현**:
   - 나무위키의 표 문법을 정확히 파싱하고 렌더링하는 기능 개발
   - 셀 병합, 배경색 지정, 정렬 등 나무위키 표의 모든 속성 지원
   - 표 내부에 다른 나무위키 문법 요소 중첩 지원 (표 안에 리스트, 링크 등)
   - 직관적인 표 편집 UI로 복잡한 표 문법을 몰라도 쉽게 사용 가능하게 구현

3. **문서 구조화 기능**:
   - 문서 내 목차 자동 생성 및 네비게이션
   - 문단별 편집 기능
   - 북마크 및 앵커 기능

### 기술적 접근 방법
1. **커스텀 파서 구현**:
   - 나무위키 문법 전용 파서 개발 (PEG.js 또는 자체 개발)
   - AST(Abstract Syntax Tree) 기반 문서 구조 관리

2. **에디터 프레임워크 확장**:
   - ProseMirror를 기반으로 나무위키 문법에 맞는 스키마 및 플러그인 개발
   - 특히 표 기능을 위한 특화된 노드 타입 및 커맨드 구현
   - prosemirror-tables를 확장하여 나무위키 표 문법의 모든 기능 지원

3. **양방향 변환 시스템**:
   - 나무위키 문법 ↔ 에디터 상태 ↔ HTML 간의 완벽한 양방향 변환
   - 문법의 손실 없는 라운드트립 보장

### 사용자 인터페이스
- **듀얼 모드**: 시각적 에디터와 문법 에디터 간 자유로운 전환
- **표 전용 툴바**: 표 생성, 행/열 추가 및 삭제, 셀 병합, 배경색 설정 등 표 관련 작업을 위한 전용 툴바
- **표 템플릿**: 자주 사용되는 표 형식을 템플릿으로 제공
- **단축키 지원**: 표 조작을 위한 풍부한 키보드 단축키
- **드래그 앤 드롭**: 표 내 행과 열의 순서 변경, 크기 조절 등을 마우스로 조작

---

## 7. 실시간 협업 기능 구현 계획
### 기술적 접근 방법
1. **CRDT 기반 협업**:
   - Conflict-free Replicated Data Type(CRDT)를 사용하여 동시 편집 충돌 해결
   - yjs 라이브러리를 활용한 문서 동기화

2. **네트워크 계층**:
   - WebSocket을 통한 실시간 통신
   - y-websocket 또는 Socket.io 활용

3. **상태 동기화**:
   - 문서 변경 사항을 델타(변경 단위)로 전송
   - 네트워크 단절 시 로컬에서 변경 내용 유지 및 재연결 시 동기화

### 사용자 경험
- **사용자 존재감**: 현재 문서를 보고 있는 사용자 표시
- **커서 위치 공유**: 다른 사용자의 커서 위치 실시간 표시
- **변경 사항 하이라이트**: 최근 변경된 부분 시각적으로 표시
- **충돌 해결 UI**: 드물게 발생할 수 있는 충돌 상황을 해결하기 위한 인터페이스

---

## 8. 보안 계획
### 인증 및 권한
- **사용자 인증**: JWT 기반 인증 시스템
- **소셜 로그인**: Google, GitHub 등 소셜 계정 연동
- **세밀한 권한 제어**: 문서, 카테고리, 기능별 권한 설정
- **2단계 인증(2FA)**: 선택적 2단계 인증 지원

### 데이터 보안
- **민감 정보 암호화**: 비밀번호 해싱, 중요 데이터 암호화
- **HTTPS 적용**: 모든 통신에 SSL/TLS 적용
- **입력 검증**: XSS, SQL 인젝션 등 공격 방지
- **안전한 HTML 필터링**: DOMPurify 등을 활용한 HTML 샌드박싱

---

## 9. 테스트 전략
### 테스트 유형
- **단위 테스트**: 개별 컴포넌트 및 함수 테스트 (Jest, React Testing Library)
- **통합 테스트**: API 및 데이터 흐름 테스트 (Supertest)
- **E2E 테스트**: 사용자 시나리오 테스트 (Cypress)
- **성능 테스트**: 로드 테스트 및 스트레스 테스트 (k6)

### 테스트 자동화
- **CI/CD 통합**: GitHub Actions 또는 GitLab CI에서 자동 테스트 실행
- **테스트 커버리지**: 80% 이상의 코드 커버리지 목표
- **회귀 테스트**: 버그 수정 시 관련 테스트 케이스 추가

---

## 10. 성능 및 확장성 고려사항
### 성능 최적화
- **서버 사이드 렌더링(SSR)**: 초기 로딩 성능 향상
- **코드 분할**: 필요한 코드만 로드하여 초기 로딩 시간 단축
- **이미지 최적화**: 이미지 리사이징 및 압축
- **캐싱 전략**: Redis를 활용한 자주 접근하는 데이터 캐싱

### 확장성 계획
- **수평적 확장**: 마이크로서비스 아키텍처 고려
- **데이터베이스 샤딩**: 대규모 데이터 처리를 위한 샤딩 전략
- **CDN 활용**: 정적 자원 배포를 위한 CDN 통합
- **로드 밸런싱**: 트래픽 분산을 위한 로드 밸런서 구성

---

## 11. 운영 및 유지보수 계획
### 모니터링 및 알림
- **시스템 모니터링**: Prometheus와 Grafana를 활용한 시스템 상태 모니터링
- **오류 추적**: Sentry를 활용한 클라이언트 및 서버 오류 추적
- **사용자 행동 분석**: Google Analytics 또는 자체 분석 도구를 통한 사용자 행동 분석

### 사용자 피드백 수집
- **피드백 폼**: 시스템 내 피드백 제출 폼
- **사용자 테스트**: 정기적인 사용자 테스트 세션 진행
- **기능 요청 시스템**: 사용자가 새로운 기능을 제안할 수 있는 시스템

### 지속적인 개선
- **정기 업데이트**: 2주 단위 스프린트로 기능 개선 및 버그 수정
- **성능 분석**: 정기적인 성능 검토 및 최적화
- **보안 업데이트**: 정기적인 보안 감사 및 패치

---

## 12. 오픈소스 전략
### 커뮤니티 구축
- **기여 가이드라인**: 명확한 기여 방법 및 코드 스타일 가이드
- **이슈 트래커**: GitHub Issues를 활용한 버그 및 기능 요청 관리
- **문서화**: 개발자 및 사용자를 위한 상세한 문서 제공
- **커뮤니티 포럼**: 사용자 및 개발자 간 소통을 위한 포럼 운영

### 라이선스
- MIT 라이선스: 자유로운 사용 및 기여 장려
- 명확한 저작권 표시 및 기여자 인정 시스템

---

## 13. 결론 및 기대 효과
이 문서 시스템은 기획, 개발, 문서화 관련 내용을 체계적으로 기록하고 관리하는 데 유용한 도구가 될 것입니다. 특히 나무위키 스타일 에디터와 강력한 표 기능을 구현함으로써 복잡한 정보를 효과적으로 표현할 수 있는 차별화된 시스템이 될 것입니다.

### 기대 효과
- **효율적인 지식 관리**: 팀 내 지식 공유 및 축적 효율성 향상
- **협업 강화**: 실시간 협업 기능을 통한 팀워크 향상
- **의사결정 투명성**: 의사결정 과정과 결과의 문서화로 투명성 확보
- **신규 팀원 온보딩**: 체계적인 문서를 통한 신규 팀원의 빠른 적응 지원
- **오픈소스 커뮤니티 기여**: 나무위키 스타일 에디터에 관심 있는 개발자들의 참여로 지속적인 개선

이 시스템이 잘 구축된다면, 프로젝트 진행을 위한 체계적인 문서화 및 관리가 가능해질 것이며, 장기적으로는 오픈소스 커뮤니티에 가치 있는 도구로 자리매김할 수 있을 것입니다.